# Firebase Authentication Flow Diagram

## ğŸ”„ Authentication Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     JS Construction CRM                         â”‚
â”‚                   Authentication System                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENT SIDE                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ login.html   â”‚         â”‚ dashboard.   â”‚                    â”‚
â”‚  â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚    html      â”‚                    â”‚
â”‚  â”‚ â€¢ Email/Pass â”‚ Success â”‚              â”‚                    â”‚
â”‚  â”‚ â€¢ Google     â”‚         â”‚ â€¢ Protected  â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â€¢ Role-based â”‚                    â”‚
â”‚         â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚         â”‚                         â”‚                            â”‚
â”‚         â–¼                         â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚        src/firebase/auth.js             â”‚                  â”‚
â”‚  â”‚                                         â”‚                  â”‚
â”‚  â”‚  â€¢ signInEmail()                       â”‚                  â”‚
â”‚  â”‚  â€¢ signInWithGoogle()                  â”‚                  â”‚
â”‚  â”‚  â€¢ signOutUser()                       â”‚                  â”‚
â”‚  â”‚  â€¢ createUserByAdmin()                 â”‚                  â”‚
â”‚  â”‚  â€¢ onAuthStateChange()                 â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚         â”‚                         â”‚                            â”‚
â”‚         â”‚                         â–¼                            â”‚
â”‚         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚         â”‚              â”‚ authGuard.js     â”‚                   â”‚
â”‚         â”‚              â”‚                  â”‚                   â”‚
â”‚         â”‚              â”‚ â€¢ requireAuth()  â”‚                   â”‚
â”‚         â”‚              â”‚ â€¢ checkAuth()    â”‚                   â”‚
â”‚         â”‚              â”‚ â€¢ getCurrentUser â”‚                   â”‚
â”‚         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚         â”‚                                                      â”‚
â”‚         â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚        src/firebase/init.js             â”‚                  â”‚
â”‚  â”‚                                         â”‚                  â”‚
â”‚  â”‚  â€¢ Firebase App                        â”‚                  â”‚
â”‚  â”‚  â€¢ Auth Service                        â”‚                  â”‚
â”‚  â”‚  â€¢ Firestore Service                   â”‚                  â”‚
â”‚  â”‚  â€¢ Functions Service                   â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚         â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ HTTPS
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FIREBASE SERVICES                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Firebase   â”‚  â”‚  Firestore   â”‚  â”‚   Cloud      â”‚        â”‚
â”‚  â”‚     Auth     â”‚  â”‚   Database   â”‚  â”‚  Functions   â”‚        â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚        â”‚
â”‚  â”‚ â€¢ Email/Pass â”‚  â”‚ users/{uid}  â”‚  â”‚ createUser() â”‚        â”‚
â”‚  â”‚ â€¢ Google     â”‚  â”‚ â€¢ email      â”‚  â”‚              â”‚        â”‚
â”‚  â”‚ â€¢ User Mgmt  â”‚  â”‚ â€¢ name       â”‚  â”‚ â€¢ Verify     â”‚        â”‚
â”‚  â”‚              â”‚  â”‚ â€¢ role       â”‚  â”‚   admin      â”‚        â”‚
â”‚  â”‚              â”‚  â”‚ â€¢ createdAt  â”‚  â”‚ â€¢ Create     â”‚        â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚   Auth user  â”‚        â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚ â€¢ Create     â”‚        â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚   Firestore  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Login Flow Sequence

```
User                login.html         auth.js          Firebase Auth    Firestore
 â”‚                      â”‚                 â”‚                    â”‚              â”‚
 â”‚  Enter credentials   â”‚                 â”‚                    â”‚              â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚                    â”‚              â”‚
 â”‚                      â”‚                 â”‚                    â”‚              â”‚
 â”‚                      â”‚  signInEmail()  â”‚                    â”‚              â”‚
 â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚              â”‚
 â”‚                      â”‚                 â”‚                    â”‚              â”‚
 â”‚                      â”‚                 â”‚  Authenticate      â”‚              â”‚
 â”‚                      â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚
 â”‚                      â”‚                 â”‚                    â”‚              â”‚
 â”‚                      â”‚                 â”‚  âœ“ User Token      â”‚              â”‚
 â”‚                      â”‚                 â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
 â”‚                      â”‚                 â”‚                    â”‚              â”‚
 â”‚                      â”‚                 â”‚  Fetch users/{uid} â”‚              â”‚
 â”‚                      â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
 â”‚                      â”‚                 â”‚                    â”‚              â”‚
 â”‚                      â”‚                 â”‚  { role, name }    â”‚              â”‚
 â”‚                      â”‚                 â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                      â”‚                 â”‚                    â”‚              â”‚
 â”‚                      â”‚  âœ“ User Data    â”‚                    â”‚              â”‚
 â”‚                      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚              â”‚
 â”‚                      â”‚                 â”‚                    â”‚              â”‚
 â”‚  Redirect dashboard  â”‚                 â”‚                    â”‚              â”‚
 â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚                    â”‚              â”‚
 â”‚                      â”‚                 â”‚                    â”‚              â”‚
```

## ğŸ” Create User Flow (Admin Only)

```
Admin              dashboard.html    auth.js         Cloud Function    Firebase Auth   Firestore
  â”‚                      â”‚              â”‚                   â”‚                 â”‚            â”‚
  â”‚  Call createUser     â”‚              â”‚                   â”‚                 â”‚            â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚                   â”‚                 â”‚            â”‚
  â”‚                      â”‚              â”‚                   â”‚                 â”‚            â”‚
  â”‚                      â”‚ createUser   â”‚                   â”‚                 â”‚            â”‚
  â”‚                      â”‚ ByAdmin()    â”‚                   â”‚                 â”‚            â”‚
  â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                 â”‚            â”‚
  â”‚                      â”‚              â”‚                   â”‚                 â”‚            â”‚
  â”‚                      â”‚              â”‚  Call Function    â”‚                 â”‚            â”‚
  â”‚                      â”‚              â”‚  (with auth token)â”‚                 â”‚            â”‚
  â”‚                      â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚            â”‚
  â”‚                      â”‚              â”‚                   â”‚                 â”‚            â”‚
  â”‚                      â”‚              â”‚                   â”‚ Verify caller   â”‚            â”‚
  â”‚                      â”‚              â”‚                   â”‚ is admin        â”‚            â”‚
  â”‚                      â”‚              â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                      â”‚              â”‚                   â”‚                 â”‚            â”‚
  â”‚                      â”‚              â”‚                   â”‚  âœ“ role=admin   â”‚            â”‚
  â”‚                      â”‚              â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                      â”‚              â”‚                   â”‚                 â”‚            â”‚
  â”‚                      â”‚              â”‚                   â”‚  Create user    â”‚            â”‚
  â”‚                      â”‚              â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚            â”‚
  â”‚                      â”‚              â”‚                   â”‚                 â”‚            â”‚
  â”‚                      â”‚              â”‚                   â”‚  âœ“ User created â”‚            â”‚
  â”‚                      â”‚              â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
  â”‚                      â”‚              â”‚                   â”‚                 â”‚            â”‚
  â”‚                      â”‚              â”‚                   â”‚  Write users/{uid}           â”‚
  â”‚                      â”‚              â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                      â”‚              â”‚                   â”‚                 â”‚            â”‚
  â”‚                      â”‚              â”‚                   â”‚  âœ“ Document created          â”‚
  â”‚                      â”‚              â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                      â”‚              â”‚                   â”‚                 â”‚            â”‚
  â”‚                      â”‚              â”‚  âœ“ Success        â”‚                 â”‚            â”‚
  â”‚                      â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚            â”‚
  â”‚                      â”‚              â”‚                   â”‚                 â”‚            â”‚
  â”‚                      â”‚  âœ“ User data â”‚                   â”‚                 â”‚            â”‚
  â”‚                      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚                 â”‚            â”‚
  â”‚                      â”‚              â”‚                   â”‚                 â”‚            â”‚
  â”‚  Success message     â”‚              â”‚                   â”‚                 â”‚            â”‚
  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚                   â”‚                 â”‚            â”‚
  â”‚                      â”‚              â”‚                   â”‚                 â”‚            â”‚
```

## ğŸ›¡ï¸ Auth Guard Flow

```
User              Protected Page    authGuard.js     Firebase Auth    Firestore
 â”‚                      â”‚                 â”‚                 â”‚             â”‚
 â”‚  Navigate to page    â”‚                 â”‚                 â”‚             â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚                 â”‚             â”‚
 â”‚                      â”‚                 â”‚                 â”‚             â”‚
 â”‚                      â”‚  requireAuth()  â”‚                 â”‚             â”‚
 â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚             â”‚
 â”‚                      â”‚                 â”‚                 â”‚             â”‚
 â”‚                      â”‚                 â”‚  Check auth     â”‚             â”‚
 â”‚                      â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚             â”‚
 â”‚                      â”‚                 â”‚                 â”‚             â”‚
 â”‚                      â”‚                 â”‚  âœ“ Authenticatedâ”‚             â”‚
 â”‚                      â”‚                 â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
 â”‚                      â”‚                 â”‚                 â”‚             â”‚
 â”‚                      â”‚                 â”‚  Fetch role     â”‚             â”‚
 â”‚                      â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
 â”‚                      â”‚                 â”‚                 â”‚             â”‚
 â”‚                      â”‚                 â”‚  { role }       â”‚             â”‚
 â”‚                      â”‚                 â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                      â”‚                 â”‚                 â”‚             â”‚
 â”‚                      â”‚                 â”‚  Check role in  â”‚             â”‚
 â”‚                      â”‚                 â”‚  allowedRoles   â”‚             â”‚
 â”‚                      â”‚                 â”‚                 â”‚             â”‚
 â”‚                      â”‚  âœ“ onAllowed()  â”‚                 â”‚             â”‚
 â”‚                      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚             â”‚
 â”‚                      â”‚                 â”‚                 â”‚             â”‚
 â”‚  Show page content   â”‚                 â”‚                 â”‚             â”‚
 â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚                 â”‚             â”‚
 â”‚                      â”‚                 â”‚                 â”‚             â”‚
```

## ğŸ“ Module Dependencies

```
login.html
    â””â”€â”€ auth.js
        â””â”€â”€ init.js
            â””â”€â”€ Firebase SDK

dashboard.html
    â”œâ”€â”€ auth.js
    â”‚   â””â”€â”€ init.js
    â””â”€â”€ authGuard.js
        â””â”€â”€ init.js

Cloud Function (functions/index.js)
    â””â”€â”€ Firebase Admin SDK
```

## ğŸ”‘ Key Security Points

1. **Double Verification**
   - Firebase Auth authenticates the user
   - Firestore document verifies role/access

2. **Server-Side Validation**
   - Cloud Function checks admin role
   - Prevents client-side bypass

3. **Access Denial**
   - Users without Firestore docs are signed out
   - Unauthorized users redirected to login

4. **Role-Based Access**
   - Different pages for different roles
   - Admin-only features protected

5. **Environment Variables**
   - Secrets not hardcoded
   - Production-ready configuration
